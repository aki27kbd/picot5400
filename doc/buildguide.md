# Build Guide

![picot5400_gallery_00](/images/gallery_00.jpg)

For English version, please visit [buildguide_en.md](buildguide_en.md)

picot5400のビルドガイドになります。  

picot5400は、マイコン（RP2040）とトラックボールセンサー（PMW3360）を1枚のボードに搭載したモジュールです。  
picot5400を用いたキーボードを組み立てる際は、このページを参照しながらモジュールの組み立てを行ってください。その他の組み立て工程は各キーボードのビルドガイドを参照してください。


## BOM

|名前|数|備考|
|---|---|---|
|picot5400 PCB|1||
|マウスセンサー（PMW3360）|1||
|M2スペーサー 3.5mm|4||
|M2ねじ 5mm|8||
|ベアリングローラー|3||
|ステンレス丸棒（直径:2mm, 長さ:6mm）|3||
|シリコンチューブ（内径:2mm, 外径:3mm）|1||
|マグネット（直径:2mm, 高さ:2mm）|8||
|3Dプリントボールケース（ベース・カバー）|1||

## 組み立て
### picot5400

  まずpicot5400をUSB接続し、PCに認識されるかを確認してください。  
  ***この工程は必ずはんだ付けを行う前に行ってください。はんだ付けを行った後に動作確認ができない場合は初期不具合には含まれませんのであらかじめご了承ください。***  

  USB機器として認識されることが確認できたら、マウスセンサーを取り付けます。  
  センサー基板にマウスセンサー（PMW3360）を基板裏面から写真の向きに設置し、表面からはんだ付けを行います。シルクの●印と基板の●印の位置が合うように注意してください。    
  ![picot5400_bg_pmw3360_1](/images/bg_pmw3360_1.jpg)

  センサーの脚がしっかり奥まで入った状態で、浮かないようにマスキング テープなどで固定します。  
  表面から16本の脚をはんだ付けします。***はんだ付けは必ずUSBケーブルを外した状態で行ってください。***  
  センサーに貼られているテープを剥がし、表面からレンズを付けます。    
  ![picot5400_bg_pmw3360_2](/images/bg_pmw3360_2.jpg)

  ![picot5400_bg_pmw3360_3](/images/bg_pmw3360_3.jpg)

  レンズを取り付けたら、再度USBに接続し、レンズ上部に手をかざしてカーソルが動くことを確認してください。

  レンズが浮かないようにしっかりと差し込んだら、裏面からレンズの突起にはんだごてを少しあて、レンズを溶かして固定します。
  ![picot5400_bg_pmw3360_4](/images/bg_pmw3360_4.jpg)  

### ボールケース

　細い方のシリコンチューブを、3mm程度の長さで3本切ります。ハサミなどで簡単に切れますが、できるだけ切断面が真っすぐになるように注意してください。  
  ![picot5400_bg_ballcase_1](/images/bg_ballcase_1.jpg)  

  ステンレス丸棒を切り出したシリコンチューブの中に通します。
  ![picot5400_bg_ballcase_2](/images/bg_ballcase_2.jpg)  

  ベアリングローラーをシリコンチューブの外側に通し、チューブとベアリングがステンレス丸棒の中央に来るように調整します。
  ![picot5400_bg_ballcase_3](/images/bg_ballcase_3.jpg)  

  ボールケース（ベース）の3本の台座に、ベアリングローラーをはめたステンレス丸棒を装着します。真上からカチッと音がするまで押し込んでください。ステンレス丸棒が台座から飛び出していなければOKです。
  ![picot5400_bg_ballcase_4](/images/bg_ballcase_4.jpg)  

  ボールケース（ベース）の四隅下側にスペーサーを固定します。  
  ![picot5400_bg_ballcase_5](/images/bg_ballcase_5.jpg)  

  picot5400の上にボールケースを重ねます。各キーボードのケースやボトムプレートに重ね、下からねじで固定します。詳細は各キーボードのビルドガイドを参照してください。  
  ![picot5400_bg_ballcase_6](/images/bg_ballcase_6.jpg)  

### ファームウェア

  ご自分でファームを書き込む場合、下記手順の通り実行してください。

  - picot5400のBOOTボタンを押しながらRESETボタンを押し、ブートローダーモードに入ります。
  - その状態でRPI-RP2というドライブに[.uf2](https://github.com/aki27kbd/picot5400/blob/main/firmware/aki27_picot5400_vial.uf2)ファイルをドラッグ&ドロップすることでファームが書き込まれます。　　

  キーマップは[vial](https://vial.rocks/)から更新可能です。  
  トラックボールの動作は後述のセンサー基板を組み立ててから行ってください。  
  ![vial](/images/vial.jpg)

  デフォルトのファームウェアでは自動マウスレイヤー機能がオンになっています。この機能では、トラックボールを動かすと自動的にマウスレイヤー（レイヤー4）に移動することが可能です。カスタムキーコード（`AM_TOG`）を押すことで自動マウスレイヤー機能のオンオフを切り替えられます。

  ソースコードは[こちら](https://github.com/aki27kbd/vial-qmk/tree/vial/keyboards/aki27/picot_o44)を参照ください。      


## カスタムキーコード

  トラックボールの操作に関していくつかカスタムキーコードを設定することが可能です。（SCRL_MOはレイヤー4でのみ有効）

  Keycode   |Description
  ---------|-----------
  `CPI_SW`  |トラックボールのCPIを変更します。デフォルトのファームウェアでは、押すたびに200→400→800→1600→3200→200…という順番でCPIが変わります。
  `SCRL_SW` |スクロールモードにおけるセンサーの感度を変更します。数値が大きいほどスクロール量が小さくなります。
  `ROT_R15` |マウスセンサーのＹ軸を時計回りに15度回転させます。
  `ROT_L15` |マウスセンサーのＹ軸を反時計回りに15度回転させます。
  `SCRL_MO` |押されている間スクロールモードになります。（デフォルトファームではレイヤー4でのみ有効）
  `SCRL_TO` |押すたびにスクロールモードとマウスモードを切り替えます。（デフォルトファームでは無効）
  `SCRL_IN` |スクロール方向を反転させます。
  `AM_TOG` |自動マウスレイヤー切り替えのオンオフを切り替えます。

  vialでカスタムキーコードを設定する場合はUserタブ下のカスタムキーコードを用いて設定することが可能です。  
  ![CustomKeycode_rev](/images/bg_customkeycode.jpg)


## 終わりに
何かトラブルがあれば[Twitterアカウント](https://twitter.com/aki27kbd)までご連絡ください。

ハッシュタグは #picot5400 です。
